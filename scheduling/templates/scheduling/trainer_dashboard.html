{% extends 'base.html' %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4 text-info">üßë‚Äçüè´ Trainer Panel</h2>
    <p class="lead">Welcome back, <strong>{{ user.first_name|default:user.username }}</strong>!</p>
    
    <div class="row">
        <!-- LEFT: My Teaching Schedule (Group Classes) -->
        <div class="col-md-6 mb-4">
            <div class="card border-success h-100">
                <div class="card-header bg-success text-white">My Group Classes</div>
                <div class="card-body">
                    {% if my_schedule %}
                        <div class="list-group">
                            {% for class in my_schedule %}
                                <div class="list-group-item">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h5 class="mb-1">{{ class.group.name }}</h5>
                                        <small>{{ class.start_time|date:"D, M d" }}</small>
                                    </div>
                                    <p class="mb-1">{{ class.start_time|time:"g:i A" }} - {{ class.end_time|time:"g:i A" }}</p>
                                    <small>Room: {{ class.room }} | Capacity: {{ class.grouprecord_set.count }}/{{ class.group.capacity }}</small>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted text-center mt-4">You have no group classes scheduled upcoming.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- RIGHT: Private Bookings Management -->
        <div class="col-md-6 mb-4">
            
            <!-- Pending Requests -->
            <div class="card border-primary mb-4">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Pending Requests</h5>
                    <span class="badge bg-light text-primary">{{ pending.count }}</span>
                </div>
                <div class="card-body">
                    {% if pending %}
                        {% for booking in pending %}
                            <div class="card mb-2 shadow-sm">
                                <div class="card-body p-3">
                                    <h6 class="card-title">{{ booking.member.user.first_name }} {{ booking.member.user.last_name }}</h6>
                                    <p class="card-text small text-muted mb-2">
                                        Requested: {{ booking.start_time|date:"M d, Y" }} at {{ booking.start_time|time:"g:i A" }}
                                    </p>
                                    
                                    <!-- Action Form -->
                                    <form method="post" class="d-flex gap-2">
                                        {% csrf_token %}
                                        <input type="hidden" name="booking_id" value="{{ booking.id }}">
                                        
                                        <!-- Buttons act as the radio select 'action' -->
                                        <button type="submit" name="action" value="active" class="btn btn-sm btn-success flex-grow-1">Accept</button>
                                        <button type="submit" name="action" value="inactive" class="btn btn-sm btn-outline-danger flex-grow-1">Decline</button>
                                    </form>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted text-center">No pending requests.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Confirmed Upcoming Sessions -->
            <div class="card border-secondary">
                <div class="card-header bg-secondary text-white">Upcoming Confirmed Sessions</div>
                <div class="card-body">
                    {% if active %}
                        <ul class="list-group list-group-flush">
                            {% for booking in active %}
                                <li class="list-group-item">
                                    <strong>{{ booking.member.user.first_name }} {{ booking.member.user.last_name }}</strong><br>
                                    <span class="text-muted">{{ booking.start_time|date:"D, M d @ g:i A" }}</span>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted text-center">No upcoming confirmed private sessions.</p>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock content %}
